name: "Assign Environment Variables"
description: "Key-Value pair to pass to github environment variables"
inputs:
  env-vars:
    description: "YAML key/value pair to add to environment"
    required: true

runs:
  using: composite
  steps:
    - name: Install yq to Parse YAML
      shell: bash
      run: |
        sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
        sudo chmod +x /usr/local/bin/yq

    - name: Iterate and assign env vars
      shell: bash
      run: |
        cat << 'EOF' > config.yml # Write input to file
        ${{ inputs.env-vars }}
        EOF

        yq eval '.[] | .key + "=" + .value' config.yml | while IFS='=' read -r key value; do
          if [[ "$value" =~ ^(echo|date|git|curl|whoami|pwd|basename|dirname|cat|grep|awk|sed) ]]; then
            executed_value=$(eval "$value")
            echo "Setting $key to $executed_value (executed)"
            echo "$key=$executed_value" >> "$GITHUB_ENV"
          else
            echo "Setting $key to $value (literal)"
            echo "$key=$value" >> "$GITHUB_ENV"
          fi
        done
